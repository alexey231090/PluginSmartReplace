# Инструкции для ИИ по работе с плагином Smart Replace

## Обзор
Плагин Smart Replace для Godot позволяет автоматически редактировать GDScript файлы через скрытые INI команды в ответах AI. Плагин автоматически извлекает и выполняет команды, не показывая их пользователю.

## Принцип работы

### Скрытые команды
- AI отвечает пользователю обычным текстом
- В ответе AI скрыто вставляет INI команды между маркерами `=[command]=` и `=[end]=`
- Плагин автоматически извлекает эти команды и выполняет их
- Пользователь видит только текстовый ответ AI

### Пример ответа AI
```
Я добавлю функцию для атаки и улучшу движение игрока.

=[command]=
[add_function]
name=attack_enemy
comment=Атака врага с уроном
<cod>
	if enemy and enemy.has_method("take_damage"):
		enemy.take_damage(damage)
		play_attack_animation()
<end_cod>
=[end]=

=[command]=
[add_code]
position=2
<cod>
# Игровые константы
const ATTACK_DAMAGE = 25
const ATTACK_RANGE = 100
<end_cod>
=[end]=

Теперь у вас есть функция атаки и константы для боевой системы!
```

## Формат команд

### Структура INI команды
```
=[command]=
[action]
name=значение
code=значение
=[end]=
```

### Маркеры команд
- `=[command]=` - начало команды
- `=[end]=` - конец команды
- `<cod>` - начало блока кода
- `<end_cod>` - конец блока кода

### Блоки кода
Код должен быть заключен в специальные маркеры для сохранения отступов:
```
<cod>
func example():
	if condition:
		do_something()
	else:
		do_else()
<end_cod>
```

## Доступные действия

### 1. Добавление функций
```
=[command]=
[add_function]
name=имя_функции
args=параметр1, параметр2
comment=описание функции
<cod>
	# код функции
	var result = parameter1 + parameter2
	return result
<end_cod>
=[end]=
```

### 2. Замена функций
```
=[command]=
[replace_function]
name=имя_функции
comment=новый комментарий (опционально)
<cod>
	# новый код функции
	var new_result = calculate_something()
	return new_result
<end_cod>
=[end]=
```

### 3. Удаление функций
```
=[command]=
[delete_function]
name=имя_функции
=[end]=
```

### 4. Добавление кода вне функций
```
=[command]=
[add_code]
position=0
<cod>
# константы
const MAX_HEALTH = 100
const SPEED = 300
<end_cod>
=[end]=
```

**Позиции для вставки:**
- `0` - в конец файла
- `1` - в начало файла  
- `2` - после extends
- `3` - перед extends
- `4` - на конкретную строку (требует line_number)

### 5. Удаление строк кода
```
=[command]=
[delete_code]
lines=5, 10-15, 23
=[end]=
```

**Формат строк:**
- `5` - удалить строку 5
- `10-15` - удалить строки с 10 по 15
- `5, 10-15, 23` - комбинированный формат

## Правила работы

### Имена функций
- Используйте `name` для идентификации функций
- Имя должно точно совпадать с существующей функцией
- GDScript не поддерживает перегрузку функций

### Комментарии
- `comment` добавляется над функцией как `# комментарий`
- При удалении функции комментарий удаляется автоматически
- При замене функции можно изменить или удалить комментарий

### Отступы
- Используйте 4 пробела для отступов
- Не используйте табуляцию
- Отступы автоматически нормализуются плагином

### Специальные символы
- `\n` - перенос строки
- `\t` - табуляция (не рекомендуется)
- `\"` - кавычка

## Примеры ответов AI

### Добавление функции с комментарием
```
Я создам функцию для вычисления урона с учетом брони.

=[command]=
[add_function]
name=calculate_damage
args=base_damage, armor
comment=Вычисляет урон с учетом брони
<cod>
	var final_damage = base_damage - armor
	if final_damage < 0:
		final_damage = 0
	return final_damage
<end_cod>
=[end]=

Теперь у вас есть функция для расчета урона!
```

### Замена функции
```
Я улучшу функцию движения игрока, добавив плавное ускорение.

=[command]=
[replace_function]
name=move_player
comment=Обновленная функция движения игрока с плавным ускорением
<cod>
	var new_position = position + direction * speed * delta
	if is_valid_position(new_position):
		position = new_position
		velocity = velocity.lerp(direction * speed, 0.1)
<end_cod>
=[end]=

Движение теперь стало более плавным!
```

### Добавление констант
```
Я добавлю игровые константы для лучшей организации кода.

=[command]=
[add_code]
position=2
<cod>
# Игровые константы
const PLAYER_SPEED = 300
const JUMP_FORCE = 500
const GRAVITY = 980
<end_cod>
=[end]=

Константы добавлены и готовы к использованию.
```

### Удаление строк
```
Я удалю отладочные print() функции из кода.

=[command]=
[delete_code]
lines=15, 20-25
=[end]=

Отладочные сообщения удалены, код стал чище.
```

## Пакетная обработка

Можно выполнить несколько команд за раз:

```
Я внесу комплексные изменения в код.

=[command]=
[add_function]
name=function1
args=
<cod>
	pass
<end_cod>
=[end]=

=[command]=
[add_code]
position=0
<cod>
var global_var = 100
<end_cod>
=[end]=

=[command]=
[delete_function]
name=old_function
=[end]=

Все изменения применены успешно!
```

## Важные замечания

1. **Скрытость команд** - пользователь не должен видеть INI команды
2. **Естественность ответа** - отвечайте как обычный помощник
3. **Имена функций** - используйте точные имена, плагин найдет функцию автоматически
4. **Отступы** - всегда используйте 4 пробела, не табуляцию
5. **Блоки кода** - обязательно используйте `<cod>` и `<end_cod>` маркеры
6. **Комментарии** - удаляются вместе с функцией при удалении
7. **Позиции вставки** - используйте `position=2` для вставки после extends
8. **Удаление строк** - поддерживает диапазоны и отдельные строки

## Ограничения

- GDScript не поддерживает перегрузку функций
- Все отступы автоматически нормализуются в 4 пробела
- Комментарии над функциями удаляются при удалении функции
- Плагин работает только с открытым файлом в редакторе
- Команды должны быть корректно сформированы для успешного выполнения 
