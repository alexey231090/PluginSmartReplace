# Инструкции для ИИ по работе с плагином Smart Replace

## Обзор
Плагин Smart Replace для Godot позволяет автоматически редактировать GDScript файлы через INI команды. Плагин может добавлять, заменять и удалять функции, а также работать с кодом вне функций.

## Формат команд

### Структура INI команды
```
=[command]=
[action]
name=значение
code=значение
=[end]=
```

### Маркеры команд
- `=[command]=` - начало команды
- `=[end]=` - конец команды
- `<cod>` - начало блока кода
- `<end_cod>` - конец блока кода

### Блоки кода
Код должен быть заключен в специальные маркеры для сохранения отступов:
```
<cod>
func example():
	if condition:
		do_something()
	else:
		do_else()
<end_cod>
```

## Доступные действия

### 1. Добавление функций
```
=[command]=
[add_function]
name=имя_функции
args=параметр1, параметр2
comment=описание функции
<cod>
	# код функции
	var result = parameter1 + parameter2
	return result
<end_cod>
=[end]=
```

### 2. Замена функций
```
=[command]=
[replace_function]
name=имя_функции
comment=новый комментарий (опционально)
<cod>
	# новый код функции
	var new_result = calculate_something()
	return new_result
<end_cod>
=[end]=
```

### 3. Удаление функций
```
=[command]=
[delete_function]
name=имя_функции
=[end]=
```

### 4. Добавление кода вне функций
```
=[command]=
[add_code]
position=0
<cod>
# константы
const MAX_HEALTH = 100
const SPEED = 300
<end_cod>
=[end]=
```

**Позиции для вставки:**
- `0` - в конец файла
- `1` - в начало файла  
- `2` - после extends
- `3` - перед extends
- `4` - на конкретную строку (требует line_number)

### 5. Удаление строк кода
```
=[command]=
[delete_code]
lines=5, 10-15, 23
=[end]=
```

**Формат строк:**
- `5` - удалить строку 5
- `10-15` - удалить строки с 10 по 15
- `5, 10-15, 23` - комбинированный формат

## Правила работы

### Имена функций
- Используйте `name` для идентификации функций
- Имя должно точно совпадать с существующей функцией
- GDScript не поддерживает перегрузку функций

### Комментарии
- `comment` добавляется над функцией как `# комментарий`
- При удалении функции комментарий удаляется автоматически
- При замене функции можно изменить или удалить комментарий

### Отступы
- Используйте 4 пробела для отступов
- Не используйте табуляцию
- Отступы автоматически нормализуются плагином

### Специальные символы
- `\n` - перенос строки
- `\t` - табуляция (не рекомендуется)
- `\"` - кавычка

## Примеры команд

### Добавление функции с комментарием
```
=[command]=
[add_function]
name=calculate_damage
args=base_damage, armor
comment=Вычисляет урон с учетом брони
<cod>
	var final_damage = base_damage - armor
	if final_damage < 0:
		final_damage = 0
	return final_damage
<end_cod>
=[end]=
```

### Замена функции
```
=[command]=
[replace_function]
name=move_player
comment=Обновленная функция движения игрока
<cod>
	var new_position = position + direction * speed * delta
	if is_valid_position(new_position):
		position = new_position
<end_cod>
=[end]=
```

### Добавление констант
```
=[command]=
[add_code]
position=2
<cod>
# Игровые константы
const PLAYER_SPEED = 300
const JUMP_FORCE = 500
const GRAVITY = 980
<end_cod>
=[end]=
```

### Удаление строк
```
=[command]=
[delete_code]
lines=15, 20-25
=[end]=
```

## Пакетная обработка

Можно выполнить несколько команд за раз:

```
=[command]=
[add_function]
name=function1
args=
<cod>
	pass
<end_cod>
=[end]=

=[command]=
[add_code]
position=0
<cod>
var global_var = 100
<end_cod>
=[end]=

=[command]=
[delete_function]
name=old_function
=[end]=
```

## Важные замечания

1. **Имена функций** - используйте точные имена, плагин найдет функцию автоматически
2. **Отступы** - всегда используйте 4 пробела, не табуляцию
3. **Блоки кода** - обязательно используйте `<cod>` и `<end_cod>` маркеры
4. **Комментарии** - удаляются вместе с функцией при удалении
5. **Позиции вставки** - используйте `position=2` для вставки после extends
6. **Удаление строк** - поддерживает диапазоны и отдельные строки

## Ограничения

- GDScript не поддерживает перегрузку функций
- Все отступы автоматически нормализуются в 4 пробела
- Комментарии над функциями удаляются при удалении функции
- Плагин работает только с открытым файлом в редакторе 